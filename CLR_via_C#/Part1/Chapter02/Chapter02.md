# Chapter02. 빌드, 패키징, 배포, 응용프로그램과 타입의 관리🍀

- 응용 프로그램과 그 안에 들어있는 타입들을 개발, 패키지로 만들고, 배포하는 단계에 대해 알아볼 것
- 응용 프로그램 내에서만 이용하는 어셈블리를 어떻게 만드는지 설명할 것임
- 관리자가 응용프로그램과 그 타입을 실행하는 것에 대해 어떻게 영향을 줄 수 있는지에 대해 이야기할 것임

## .NET Framework 배포 목표
- Windows는 불안정하고 복잡한 운영체제라는 인상을 가지고 있었음
- Windows OS에 대한 나쁜 인상의 첫 번재 이유: MS 또는 다른 모든 SW 제조사들이 만드는 프로그램들은 동적 링크 라이브러리(DLL)을 사용함
    - 사용자들은 어떤 제조사가 개발한 프로그램 내의 코드를 업데이트하고 새로운 파일을 배포할 때마다 문제를 겪게 됨
    - 배포된 새로운 파일들이 이전 버전의 파일과 호환성을 가지지 않는 경우가 있음
    - 새로운 응용프로그램 설치 시, 기존에 설치된 응용 프로그램들에 문제가 발생함
        - 이런 상황 = **DLL 지옥(DLL Hell)**

- Windows OS에 대한 나쁜 인상의 두 번재 이유: Windows 설치가 복잡하다고 여겨짐
    - 설치된 응용프로그램은 단순히 하나의 분리 가능한 항목이 아님
    - 설치되는 응용프로그램은 관련된 파일들과 만들어지는 레지스트리에 대한 정보도 함께 가져가야 함 -> 백업 위해서는어려운 작업을 거쳐야 함
    - 프로그램을 다른 컴퓨터로 가져가는 것도 어려움
    - 반드시 다른 PC에서도 같은 설치 프로그램 실행해서 모든 파일과 레지스트리 설정이 정확히 들어가도록 해줘야 함

- Windows OS에 대한 나쁜 인상의 세 번재 이유: 보안에 관련된 부분
    - 응용프로그램들이 설치되면 여러 다른 제조사들이 만든 파일이나 정보들이 함께 유입됨(얘가 무슨 짓을 할 지 몰라...)
    - 사용자들을 안심시키기 위해, 시스템에 보안에 대한 체계가 잡혀있어야 함
    - 컴퓨터의 다양한 자원에 접근 가능한 수많은 소프트웨어들ㅇ 대한 정책을 명시적으로 켜거나 끌 수 있도록 해야 함
    
## 모듈 안에 타입 만들기
```C#
public sealed class Program{
    public static void main()
    {
        System.Console.WriteLine("Hi");
    }
}
```
- 이 응용프로그램은 Program이라고 불리는 타입 하나를 정의하고 있음
- Main 안에는 System.Console이라는 타입에 대한 참조가 있음
- 이 타입은 MS 에 의해 구현되었고 중간 언어 코드가 이 타입을 구현하기 위해 MSCORLIB.DLL 파일 안에 쓰임

- 이 파일을 다음과 같은 명령문을 통해 컴파일함
`csc.exe /out:Program.exe /t:exe /r:MSCorLib.dll Program.cs`
- /out:Program.exe라는 명령문을 통해 C# 컴파일러에 PROGRAM.EE라는 실행 파일을 생성할 것을 요청함
- /t:exe 스위치를 통해 Win32 콘소 ㄹ응용프로그램의 형태로 만들 것을 요청 중
- /r:mscorlib.dll 스위치를 지정해서 컴파일러에 외부 타입들을 MSCORLIB.DLL이라는 파일 안에서 찾아보도록 지시함

- MSCORLIB.DLL파일은 핵심적인 기본 타입들을 포함하는 특별한 파일임
- 이런 타입들은 자주 쓰이므로 C# 컴파일러는 자동으로 MSCORLIB.DLL 어셈블리를 찾아봄
- /r 스위치를 무시하고 다음과 같이 써도 같은 의미임

`csc.exe /out:Program.exe /t:exe Program.cs`

- /out:Program.exe와 /t:exe 스위치도 기본값이므로 다음과 같이 줄여써도 같은 의미임

`csc.exe Program.cs`

- C# 컴파일러가 MSCORLIB.DLL 어셈블리를 참조하지 않게 ㅎ고 싶다면 /nostdlib 스위치 사용

## 메타데이터에 대해 잠시 살펴보기
- 메타데이터 블록은 켳 개의 테이블로 구성된 이진 데이터(Binary Data)임.
- 테이블은 세 가지 카테고리로 구분됨: 정의 테이블, 참조 테이블, 매니페스트 테이블

- PROGRAM.EXE 안에는 Program이라는 이름을 가지는 TypeDef 항목이 들어있음
- 이 타입은 어셈블리 안이든 밖이든 모두 접근을 허용하는 Public 한정자를 가지고 있음
- 추가 상속이 불가능한 sealed 타입
- 다른 어셈블리로부터 온 타입인 System.Object 타입으로부터 상속된 클래스 타입임
- Program 타입은 Main 메서드와 생성자 메서드인 .ctor 메서드를 정의하고 있다는 것 알 수 있음

- ILDASM.EXE 도구를 톻해 세부적인 정보를 얻을 수 있음 
- CLR 그 자체와 세부적인 기능들에 대해서도 이해 가능

## 여러 모듈을 하나의 어셈블리로 통합하기
- 어셈블리: 타입에 대한 정의가 담겨있는 파일 + 리소스 파일들
- 어셈블리는 매니페스트를 포함함
- 보안을 준수하는 기본 단위
- 매니페스트: 어셈블리의 일부로 포함되는 여러 다양한 파일들의 이름을 저장하는 메타데이터 테이블들의 또 다른 집합
    - 어셈블리의 버전, 문화권, 게시자, 외부에서 사용할 수 있도록 공개된 타입들, 어셈블리를 이루는 파일들에 대해 설명함

- CLR은 매니페스트 메타데이터 테이블 먼저 읽어들임
- 어셈블리 내부에 존재하는 다른 파일들 사용하기 위해 매니페스트를 사용하여 이름 확인
- **어셈블리의 주요한 특징**
    - 어셈블리 안에는 재사용 가능한 타입들을 정의하고 있음
    - 어셈블리에는 버전 번호가 기록되어 있음
    - 어셈블리는 어셈블리에 관련된 보안 정보들을 가지고 있을 수 있음
- 다중 파일 어셈블리(Multifile Assembly)를 사용하려는 이유
    - 배포하려는 타입들을 몇 개의 파일로 쪼개 분할 배포 가능, 앞에서 언급한 것처럼 인터넷상에서 다운로드할 경우 필요한 파일만을 다운로드해서 효율성 개선 가능
    - 리소스나 데이터 파일들을 어셈블리에 포함시킬 수 있음
    - 하나의 어셈블리를 만들면서 여러 다른 프로그래밍 언어로 만든 타입을 하나로 통합 가능함(단, 이 언어들이 모두 CLR을 사용해야 함)

## 어셈블리 버전 리소스 정보

## 문화권

## 단순 응용프로그램 배포

## 단순한 관리와 설정


# Chapter02. 윈도우 프로그래밍 모델

## 1.2.2 Win32 API 윈도우 프로그래밍 모델

- **윈도우 프로그래밍을 하려면 이벤트와 메세지의 관계를 정확하게 이해하려 노력해야 함**
  - 이것이 윈도우 프로그램의 동작 원리이기 때문
- 무엇이 이벤트이고 무엇이 메시지인가?
  - 이벤트를 발생시키는 장치: 마우스, 키보드
  - 메시지: 이벤트의 결과로 발생하는 것
  - 윈도우 운영체제: 하드웨어적인 키보드/마우스 이벤트를 메세지로 변환해서 보내주는 것
- **윈도우 프로그래밍의 핵심 원리: 이벤트로 인해서 발생된 메시지를 처리하는 것**

## 1.2.3 메세지 큐의 존재
- 시작 버튼에 마우스 클릭을 여러 번 하면 이벤트 발생
- 발생한 이벤트는 WM_LBUTTONDOWN이라는 메세지를 시작 버튼에 여러 번 보냄
- 바쁜 관계로 처리하지 못한 메세지를 작업 표시줄이 잘 기억하고 있다가 한 번에 처리를 한다.
- **어디에 저장을 하나?** 
  - **메세지 큐**에 저장을 한다
  - 메세지 큐는 일종의 '링크드 리스트'
  - 메세지를 보내야 하는 상황이 되면 어느 윈도우에 해당 메세지를 보내줄 것인지를 결정
- 작업관리자와 메모장을 켰음
- 작업관리자에서 메모장을 클릭하고 '작업 끝내기'를 클릭
- 이벤트가 발생한 마우스 포인터의 화면상 좌표는 작업 관리자 윈도우 영역
  - 마우스 클릭 이벤트 발생 -> 운영체제가 감지
  - 운영체제는 해당 이벤트 내용 확인 -> 메시지 만듬 -> **시스템 큐에 메세지 추가**
  - 운영체제는 마우스가 클릭된 위치 및 각종 정보를 근거로 메시지가 전달되어야 하는 윈도우를 선택 -> 해당 윈도우의 **메시지 큐에 메시지 넣어줌, 시스템 큐에서는 빼냄**(여기서는 작업관리자의 메세지 큐에 넣음)
  - 새로운 메시지가 작업 관리자의 메시지 큐에 저장됨
  - **작업 관리자 프로세스는 루프를 계속 돌면서 메시지 큐에 메시지가 있는지 검사**
  - 새로운 메시지가 있음을 발견하고 이 메시지를 꺼냄
  - 꺼낸 메시지를 인자로 해서 **작업 관리자의 윈도우 프로시저 함수(WndProc)를 호출**
  - 작업 관리자의 윈도우 프로시저 함수에서는 마우스 클릭 메시지가 발생했을 때 어떻게 할 것인지 **적절하게 처리하고 결과를 반영**

## 1.2.4 프로그램 소스 분석(윈도우 프로그래밍에서 이론적 내용만 정리)

- 윈도우 핸들: 사람으로 치면 주민등록번호 같은 것(자신을 식별하는 번호)
  - **윈도우 핸들을 알면 해당 윈도우를 제어할 수 있음**
- **윈도우 탐색기 역시 윈도우 프로그램 중 하나이며 메시지 큐와 메시지 루프를 가지고 있음**
- 인스턴스 핸들: 실행되는 본 프로그램 자체를 식별하는 값

- 윈도우 프로시저 함수의 위치를 등록하는 경우가 있음 
  - 왜?
  - 이유: 내가 직접 호출하는 게 아니라, 자동적으로 호출되어지는 것
  - 윈도우 프로시저 함수는 메시지가 발생했을 때, 그 메시지를 어떻게 처리할 것인지 정의하고 있는 중요한 함수
- 메시지: 비동기적으로 수시로 발생하는 것
- 비동기적으로 발생한 메시지가 큐에 들어왔을 때 윈도우 프로시저 함수는 호출되어야 함(그러나 프로그래머가 직접 이 함수를 호출 불가능)
- 대신 메시지 루프가 메시지가 있는 지 수시로 큐를 검사
- 메시지가 있으면 윈도우 프로시저를 호출
- **CallBack() 함수**: **어떠한 상황에서 자동으로 호출되는 함수**
  - 이런 함수는 직접 호출하는 게 아니라 함수 구현해서 함수 주소를 등록시키면 알아서 호출되는 것
- InitialInstance() 함수는 실제 윈도우를 생성하는 역할을 담당함
- 메시지: 어떤 상수 값(부호가 없는 정수값)

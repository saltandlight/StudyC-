# 20191218

## Chapter7. 델리게이트, 이벤트, 어트리뷰트

### 델리게이트
- '델리게이트(delegate)': '위임' 또는 '대리자'로 번역됨
- C/C++에서 사용하는 함수 포인터와 동일한 개념
- 주로 이벤트와 관련된 처리에 사용됨
- C#에서 델리게이트는 메서드의 포인터를 저장할 뿐 내부에 코드를 기술하지 않음
- 델리게이트는 delegate 키워드를 사용해서 선언함

`public delegate [메서드이름];`

- 델리게이트는 호출할 메서드와 시그너처가 정확하게 일치해야 함
- 두 정수를 입력받아 그 값을 더해서 반환하는 Add() 메서드가 있다면

```C#
public int Add(int a, int b)
{
    return a+b;
}
```

-> 이 메서드의 호출을 대리할 델리게이트는 다음과 같은 형태가 되어야 함
```C#
delegate int AddDelegate(int a, int b);
```
- 델리게이트는 대리할 메서드와 이름은 달라도 되지만 반환형과 매개변수 타입 및 개수 등은 반드시 일치해야 함
- 델리게이트를 이용해 호출할 메서드가 정해져 있음.
```C#
 class Arithmetic
    {
        public int Add(int a, int b) { return a + b; }
        public int Sub(int a, int b) { return a - b; }
        public int Mul(int a, int b) { return a * b; }
        public int Div(int a, int b)
        {
            if ((a == 0) || (b == 0)) return 0;
            return a / b;
        }
        public void PrintInfo(string str)
        {
            System.Console.WriteLine("Arithmetic::PrintInfo = {0}", str);
        }
    }
    //메서드의 포인터를 저장할 뿐 내부에 코드 기술 안 함 
    //호출할 델리게이트 정의
    public delegate int ArithmeticDelegate(int a, int b);
    public delegate void PrintInfoDelegate(string str);

    class DelegateExam1
    {
          public static void Main()
        {
            //클래스 인스턴스 생성
            Arithmetic obj = new Arithmetic();
            //Add(int a, int b) 메서드 호출하기 위해서 사용
            ArithmeticDelegate ex1 = new ArithmeticDelegate(obj.Add);
            System.Console.WriteLine("Add: ex(20,10) = {0}", ex1(20, 10));
            ex1 = new ArithmeticDelegate(obj.Sub);
            //시그너처가 동일한 다른 메서드를 호출하고 싶다면
            //new 연산자 이용 -> 해당 메서드를 새로 지정해야 함.
            System.Console.WriteLine("Sub: ex(20,10) = {0}", ex1(20, 10));
            ex1 = new ArithmeticDelegate(obj.Mul);
            System.Console.WriteLine("Mul: ex(20, 10) = {0}", ex1(20, 10));
            ex1 = new ArithmeticDelegate(obj.Div);
            System.Console.WriteLine("Div: ex(20,10) = {0}", ex1(20, 10));

            PrintInfoDelegate ex2 = new PrintInfoDelegate(obj.PrintInfo);
            ex2("델리게이트 예제");
        }
    }
```
- PrintInfo 메서드를 델리게이트로 호출하고 싶다면 PrintInfo 메서드와 시그너처가 일치하는 PrintInfoDelegate 델리게이트를 사용해야 함

```C#
    class Example
    {
        public static void StaticMethod()
        {
            Console.WriteLine("Static 메서드");
        }

        public void NormalMethod()
        {
            Console.WriteLine("Normal 메서드");
        }
    }
    delegate void ExamDelegate();
    class DelegateExam2
    {
        static void Main(string[] args)
        {
            Example obj = new Example();
            ExamDelegate ex1 = new ExamDelegate(obj.NormalMethod);
            ExamDelegate ex2 = new ExamDelegate(Example.StaticMethod);
            ex1();
            ex2();
        }
    }
```
- static 형 메서드를 델리게이트로 접근 시 [클래스명.메서드명] 형태가 되어야 함 
  -> Example.StaticMethod 이용 

[실행결과]
Normal 메서드
Static 메서드

- static형 메서드를 델리게이트로 접근할 때 [클래스명.메서드명] 형태가 되어야 함
- Example 클래스의 인스턴스인 obj 통해 StaticMethod() 호출 시,
  정적 멤버는 인스턴스 참조를 사용해서 액세스할 수 없다는 컴파일 에러 메세지를 볼 수 있음.
- 하나의 델리게이트에 여러 개의 델리게이트를 등록 및 제거 가능함.
    - 델리게이트 등록 시: +=
    - 델리게이트 제거 시: -=

```C#
 class Example
    {
        public static void StaticMethod()
        {
            Console.WriteLine("Static 메서드");
        }
        public void NormalMethod()
        {
            Console.WriteLine("Normal 메서드");
        }
    }

    delegate void ExamDelegate();

    class DelegateExam3
    {
        static void Main(string[] args)
        {
            Example obj = new Example();
            ExamDelegate ex1 = new ExamDelegate(obj.NormalMethod);
            ExamDelegate ex2 = new ExamDelegate(Example.StaticMethod);
            ExamDelegate data;

            data = ex1;
            data();
            Console.WriteLine("=====================\n");
            data += ex2;
            data();
            Console.WriteLine("=====================\n");
            data -= ex1;
            data();
            Console.WriteLine("=====================\n"); 
        }
    }
```


### 이벤트 처리
- 이벤트: 특정 사건이 발생됐음을 알리는 메세지 
- 마우스 클릭, 키보드 누름 등 특정 사건 발생 시 운영체제나 해당 프로그램은 사건의 종류에 따라 특정 메세지를 발생
  -> 운영체제나 해당 프로그램은 사건의 종류에 따라 특정 메시지를 발생시킴.

- 발생된 메시지는 해당 애플리케이션에 전달되어 처리됨

```C#
public delegate void MyDelegate();
private event MyDelegate ExamEvent();
```

- 이벤트는 델리게이트 객체 선언에 event 키워드를 덧붙여 선언함
- 이벤트 정의했으면, += 및 -= 연산자 이용해서 이벤트 핸들러를 등록 및 제거 가능함.

```C#
ExampleClass obj = new ExampleClass();
ExamEvent += new MyDelegate(obj.Method);
```

- 이벤트 핸들러는 다음과 같이 정의함

```C#
public delegate void EventHandler(object sender, EventArgs args)
```
- object sender: 보통 호출한 객체를 가리키는 this가 사용됨
- EventArgs args: 이벤트 핸들러 파라미터

- sender: 이벤트를 보내는 객체
- args: 이벤트 핸들러가 사용하는 파라미터
- 이벤트 파라미터는 System.EventArgs 클래스를 상속받은 별도의 파라미터 객체에 의해 작성됨

**C# 이벤트를 만들어 사용하려면?**
1. 델리게이트를 만들거나 지정함
2. 다음을 포함한 클래스 만듦
  - 델리게이트에서 만든 이벤트
  - event 키워드를 사용하여 선언된 델리게이트의 인스턴스가 있는지 확인하는 메서드
  - 이벤트를 호출하는 메서드 
3. 메서드를 이벤트에 연결하는 클래스를 하나 이상 지정함
  - -+=및 -= 연산자를 사용해서 하나 이상의 메서드를 기본 클래스의 이벤트에 연결함
  - 이벤트에 연결되는 메서드의 정의
4. 다음과 같이 이벤트를 사용함
  - 이벤트 선언을 포함하는 클래스의 개체를 작성
  - 사용자가 정의한 생성자를 사용하여 이벤트의 정의가 포함된 클래스의 개체 작성

### 어트리뷰트
#### DllImport 어트리뷰트
#### Obsolete 어트리뷰트
